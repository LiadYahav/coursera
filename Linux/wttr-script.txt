#! /bin/bash

today=$(date "+%Y%m%d")

weather_report=raw_data_$today

city=Casablanca
curl wttr.in/$city --output $weather_report

grep Â°C $weather_report > temp.txt

obs_tmp=$(head -1 temp.txt | tr -s " " | xargs | rev | cut -d " " -f2 | rev | sed 's/\x1B\[[0-9;]*[JKmsu]//g')
fc_tmp=$(head -3 temp.txt | tail -1 | tr -s " " | xargs | cut -d "C" -f3 | rev | cut -d " " -f2 | rev | sed 's/\x1B\[[0-9;]*[JKmsu]//g')
echo $obs_tmp $fc_tmp

hour=$(TZ='Morocco\Casablanca' date -u +%H)
day=$(TZ='Morocco\Casablanca' date -u +%d)
month=$(TZ='Morocco\Casablanca' date -u +%m)
year=$(TZ='Morocco\Casablanca' date -u +%Y)

record=$(echo -e "$year |   $month  |   $day    |   $hour   |   $obs_tmp    |   $fc_tmp ")
echo $record>>rx_poc.log

